<!DOCTYPE html>
<html>
    <head>
        <title>Play english listen</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script language="javascript">
            $(document).ready(function() {
                function handleFile(event) {
                    var files = event.target.files;
					var audio = document.getElementById("play_file");
					var duration = 0;
					for (var i = 0; i < files.length; i++){
					    audio.src = URL.createObjectURL(files[i]);
						audio.load();
					}
					
                    var i = 0, j = 1;
                    audio.addEventListener('ended', function () {
                        i = ++i < files.length ? i : 0;
                        audio.src = URL.createObjectURL(files[i]);
						var name = files[i]['name'];
						var str_len = name.length;
						var src = name.substring(0, str_len - 4);
						document.getElementById("script").src = "img/" + src + ".PNG";
                        audio.playbackRate = 1.2;
						audio.play();
						scroll();
						i == 0 ? j++ : false ;
						$("#count").text(j);
                    }, true);
					$("#count").text(j);
                    audio.playbackRate = 1.2;
                    audio.src = URL.createObjectURL(files[0]);
					var name = files[0]['name'];
					var str_len = name.length;
					var src = name.substring(0, str_len - 4);
					document.getElementById("script").src = "img/" + src + ".PNG";
                    audio.play();
					scroll();
                }

				function scroll(){
					var interval;
					window.scrollTo(document.body.scrollHeight, 0)
					setTimeout(function(){
						while($(window).scrollTop() + $(window).height() != $(document).height()){
						window.scrollBy(0,20);
					}},20000);
					
				}

                document.getElementById("file").addEventListener("change", handleFile, true);
			});
        </script>
    </head>
	<div align="center">
		<input type="file" id="file" multiple><br>
		<audio id="play_file" controls>
		</audio>
		<p>Đang nghe lần thứ: <b><span id="count"></span></b></p>
		<div><img id="script" /></div>
	</div>
</html>